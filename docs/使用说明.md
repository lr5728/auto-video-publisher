# 视频自动发布系统 - 使用说明

## 一、环境准备

### 系统要求
- Python 3.8+
- Google Chrome 浏览器（系统已安装）
- macOS / Windows / Linux

### 安装步骤

```bash
cd 自动发布
python setup.py
```

setup.py 会自动完成：
1. 安装 Python 依赖（playwright）
2. 下载 Chromium 浏览器
3. 创建必要的目录和文件

### 手动安装（如果 setup.py 失败）

```bash
pip install playwright
playwright install chromium
```

---

## 二、启动程序

```bash
python main.py
```

启动后会看到主菜单：

```
  【视频发布】
    1. 发布到视频号
    2. 发布到抖音

  【视频管理】
    3. 添加视频
    4. 查看视频列表
    5. 删除视频

  【账号管理】
    6. 添加抖音账号
    7. 查看/管理抖音账号
    8. 打开抖音账号
    9. 视频号账号管理

  【配置】
   10. 抖音发布配置
   11. 查看任务状态

    0. 退出
```

---

## 三、首次使用流程

### 第一步：添加账号

**抖音账号（选择菜单 6）：**
1. 程序会打开浏览器
2. 使用抖音APP扫码登录
3. 登录完成后按回车
4. 输入账号名称
5. 登录状态自动保存（可添加多个账号）

**视频号账号（选择菜单 9）：**
1. 选择"扫码登录"
2. 使用微信扫码
3. 登录状态自动保存（7天有效）

### 第二步：添加视频

选择菜单 3，按提示输入：
- 视频文件路径
- 短标题
- 详细描述
- 分类（可选）
- 话题标签（可选，空格分隔）

### 第三步：发布

选择菜单 1（视频号）或 2（抖音）：
1. 输入发布日期
2. 系统自动生成任务（分配时间）
3. 确认后开始自动发布

---

## 四、videos.json 文件说明

所有视频信息存储在 `data/videos.json` 文件中。你可以通过程序菜单添加，也可以直接编辑这个文件。

### 文件格式

```json
[
  {
    "id": "v001",
    "video_path": "/path/to/video.mp4",
    "title": "短标题",
    "description": "详细描述内容",
    "category": "分类名称",
    "topics": ["话题1", "话题2"],
    "published_douyin": false,
    "published_wechat": false,
    "publish_time_douyin": null,
    "publish_time_wechat": null,
    "added_at": "2026-02-15 10:00:00"
  }
]
```

### 字段说明

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `id` | string | 是 | 唯一标识，格式 "v001"、"v002"... 程序自动生成 |
| `video_path` | string | 是 | 视频文件的完整路径。支持绝对路径和相对路径（相对于项目根目录） |
| `title` | string | 是 | 短标题，用于视频号标题和抖音标题（抖音会截取前30字） |
| `description` | string | 是 | 详细描述，发布时作为视频简介 |
| `category` | string | 否 | 分类名称，自定义，用于管理和筛选 |
| `topics` | array | 否 | 话题标签列表，发布时自动添加为 #话题 |
| `published_douyin` | bool | - | 是否已发布到抖音，发布成功后自动改为 true |
| `published_wechat` | bool | - | 是否已发布到视频号，发布成功后自动改为 true |
| `publish_time_douyin` | string | - | 抖音发布时间，自动记录 |
| `publish_time_wechat` | string | - | 视频号发布时间，自动记录 |
| `added_at` | string | - | 添加时间，自动记录 |

### 手动编辑示例

如果你有批量视频需要添加，可以直接编辑 `data/videos.json`：

```json
[
  {
    "id": "v001",
    "video_path": "data/videos/product1.mp4",
    "title": "新款连衣裙上市",
    "description": "2026春季新款连衣裙，面料舒适透气",
    "category": "服装",
    "topics": ["新款", "连衣裙", "春装"],
    "published_douyin": false,
    "published_wechat": false,
    "publish_time_douyin": null,
    "publish_time_wechat": null,
    "added_at": "2026-02-15 10:00:00"
  },
  {
    "id": "v002",
    "video_path": "data/videos/product2.mp4",
    "title": "休闲T恤推荐",
    "description": "百搭休闲T恤，多色可选",
    "category": "服装",
    "topics": ["T恤", "休闲"],
    "published_douyin": false,
    "published_wechat": false,
    "publish_time_douyin": null,
    "publish_time_wechat": null,
    "added_at": "2026-02-15 10:01:00"
  }
]
```

**注意事项：**
- `id` 必须唯一，建议按 "v001"、"v002" 递增
- `video_path` 如果用相对路径，是相对于项目根目录的
- 手动编辑后，确保 JSON 格式正确
- 已发布的视频（published=true）不会被再次选中发布

---

## 五、抖音发布配置

通过菜单 10 可以修改抖音发布参数：

| 配置项 | 默认值 | 说明 |
|--------|--------|------|
| 每账号视频数 | 7 | 每个抖音账号每次生成的任务数 |
| 开始时间 | 8:00 | 第一条视频的定时发布时间 |
| 时间间隔 | 2小时 | 相邻视频之间的时间间隔 |

示例：默认配置下，7个视频的发布时间为：8:00、10:00、12:00、14:00、16:00、18:00、20:00

配置文件存储在 `data/config/douyin_config.json`。

---

## 六、目录结构

```
自动发布/
├── main.py                # 主程序入口
├── config.py              # 全局配置
├── videos.py              # 视频管理
├── tasks.py               # 任务生成
├── setup.py               # 初始化脚本
├── requirements.txt       # Python依赖
├── publishers/            # 发布模块
│   ├── douyin.py          #   抖音发布器
│   ├── wechat.py          #   视频号发布器
│   └── wechat_config.py   #   视频号页面选择器
├── accounts/              # 账号管理
│   ├── douyin_manager.py  #   抖音账号管理
│   └── wechat_manager.py  #   视频号账号管理
├── docs/                  # 文档
│   └── 使用说明.md        #   本文件
└── data/                  # 数据目录（自动创建）
    ├── videos.json        #   视频列表
    ├── videos/            #   视频文件存放目录
    ├── tasks/             #   任务文件
    ├── config/            #   配置文件
    └── browser_state/     #   浏览器登录状态
```

---

## 七、常见问题

**Q: 登录状态过期了怎么办？**
A: 重新执行账号添加（抖音菜单6，视频号菜单9），重新扫码登录即可。抖音登录状态一般持续较长时间，视频号约7天。

**Q: 发布失败了怎么办？**
A: 再次选择发布，程序会检测到未完成的任务，可以选择继续执行。失败的任务会自动重试。

**Q: 怎么给多个抖音账号发布不同的视频？**
A: 程序会自动将视频分配给各个账号。例如有14个视频和2个账号，每个账号会分配7个视频。

**Q: 可以同时发布到抖音和视频号吗？**
A: 需要分别执行。先发布到一个平台，再发布到另一个。videos.json 会分别记录两个平台的发布状态。

**Q: 怎么把这个工具分享给别人？**
A: 直接把整个 `自动发布` 文件夹复制给对方，对方运行 `python setup.py` 初始化后即可使用。`data/` 目录下的个人数据（账号、视频）不会影响程序运行。
